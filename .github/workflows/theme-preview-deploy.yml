name: Preview - Deploy Shopify Theme

on:
  workflow_call:
    secrets:
      SHOPIFY_PASSWORD:
        required: true
      SHOPIFY_STORE_URL:
        required: true
      ASANA_SECRET:
        required: true
      ASANA_TOKEN:
        required: true
      ASANA_PR_PROJECT_ID:
        required: true
      ASANA_PR_ASSIGNEE:
        required: true

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:  
    - name: Check out Git repository
      uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: '16'
    - run: yarn install
    - name: Get current date
      id: date
      run: echo "::set-output name=date::$(($(date +'%s%N')/1000000))"
    - run: yarn build
      env: 
          TIMESTAMP: ${{ steps.date.outputs.date }}
    - name: Deploy preview theme
      uses: Shopfabrik-Berlin/shopify-actions@shopify-2.1
      env:
        TASK: PREVIEW
        SHOPIFY_PASSWORD: ${{ secrets.SHOPIFY_PASSWORD }}
        SHOPIFY_STORE_URL: ${{ secrets.SHOPIFY_STORE_URL }}
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        ASANA_TOKEN: ${{ secrets.ASANA_TOKEN }}
        ASANA_PR_PROJECT_ID: ${{ secrets.ASANA_PR_PROJECT_ID }}
        ASANA_PR_ASSIGNEE: ${{ secrets.ASANA_PR_ASSIGNEE }}
